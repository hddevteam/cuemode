# 更新日志

CueMode 提词器扩展的所有重要更改都将记录在此文件中。

格式基于 [Keep a Changelog](https://keepachangelog.com/en/1.0.0/)，
项目遵循 [语义化版本控制](https://semver.org/spec/v2.0.0.html)。

## [2.8.0] - 2025-11-04 - 代码换行符标记与 UI 清理

### ✨ 新功能

- **代码块换行符可视化**：仅在代码块中的真实换行位置显示标记
  - 通过在 <br> 前插入显式 `<span class="cm-break-marker"></span>` 实现可靠渲染
  - 不在自动换行位置显示
  - 即使最后一行没有结尾换行符也显示行尾标记（`cm-break-eol`）
- **激活时关闭右侧辅助栏（Chat）**：无干扰模式现会同时关闭侧边栏、面板和辅助栏

### 🎨 用户体验改进

- 代码块默认启用换行（white-space: pre-wrap），避免水平滚动
- 针对长 token 增加 word-break/overflow-wrap，提升可读性

### 🔧 技术改进

- 新增 `cuemode.showLineBreaks` 设置（默认：true），类型与配置完整接入
- 解析器在 `<pre class="markdown-code-block"><code>…</code></pre>` 中的真实换行处注入标记
- Webview CSS 仅在代码块内渲染标记，普通段落不受影响
- `UIStateManager.hideUI()` 增加 `workbench.action.closeAuxiliaryBar` 调用并优雅降级

### 📚 文档

- 更新英文/中文 README，说明换行标记与辅助栏关闭行为
- 更新 GitHub Pages 至 v2.8.0，加入新功能说明

### 🧪 测试

- 更新测试以包含 `showLineBreaks` 配置并校验代码块换行样式
- 验证标记仅出现在代码块中，行尾标记正确显示

## [2.6.0] - 2025-10-20 - 自动 UI 管理

### ✨ 新功能

- **自动 UI 管理**：CueMode 现在提供无干扰的演示体验
  - **自动关闭侧边栏**：激活 CueMode 时自动关闭侧边栏
  - **自动关闭面板**：演示期间隐藏终端、输出和调试面板
  - **智能恢复**：退出 CueMode 时侧边栏恢复
  - **非阻塞**：即使 UI 优化失败，CueMode 仍能继续工作

### 🎨 用户体验改进

- **无缝激活**：开始演示前无需手动清理 UI
- **专业体验**：干净、无干扰的全屏演示模式
- **自动恢复**：UI 状态无需用户干预即可保留和恢复

### 🔧 技术改进

- 新增 `UIStateManager` 类用于管理 VS Code UI 状态
- 与 WebViewManager 集成以实现自动状态恢复
- 具有优雅降级的健壮错误处理
- UI 状态管理的全面单元测试
- 具有适当时序的异步状态保存/恢复

### 📚 文档

- 代码注释中的技术实现细节
- 测试指南和用户体验流程
- 已知限制和未来增强

## [2.5.0] - 2025-10-17 - 字体大小控制与界面改进

### ✨ 新功能

- **字体大小调整快捷键**：通过键盘快捷键动态控制字体大小
  - **VS Code 快捷键**：`Ctrl+Shift+=` / `Cmd+Shift+=` 增大，`Ctrl+Shift+-` / `Cmd+Shift+-` 减小
  - **Webview 快捷键**：`]` 键增大，`[` 键减小
  - **增量调整**：每次调整 2 个字体点数，实现精确控制
  - **范围**：8pt - 100pt，到达边界时显示通知
  - **自动保存**：设置通过 `cuemode.fontSize` 跨会话持久化
  - **实时预览**：提词器模式下即时视觉反馈
  - **帮助集成**：新快捷键已记录在帮助对话框中（H 键）

### 🎨 UI/UX 改进

- **固定 UI 元素尺寸**：帮助面板和控制按钮现使用固定像素大小
  - 帮助面板：固定为 14px（之前相对于内容字体大小）
  - 控制按钮：固定为 13px，保持一致可用性
  - 独立字体系列，提升可读性
  - 防止内容字体过大/过小时 UI 不可用

### 🌐 国际化

- **完整 i18n 支持**：所有 6 种语言已更新新功能翻译
  - 英语、简体中文、德语、法语、日语、韩语
  - 命令描述："增大字体" / "减小字体"
  - 通知：字体大小已更改、已达到最大值/最小值
  - 帮助快捷键：所有语言中的"[/]: 减小/增大字体"

### 🔧 技术改进

- 使用 `increaseFontSize` 和 `decreaseFontSize` 消息类型增强 `WebviewMessage` 类型
- 向扩展添加 `increaseFontSize()` 和 `decreaseFontSize()` 方法
- 使用固定大小 UI 组件改进 CSS 架构
- Webview 和扩展之间的消息传递用于字体调整
- 保持 100%测试覆盖率（134/134 测试通过）

### 📚 文档

- 更新帮助对话框，包含字体大小调整快捷键
- 向所有语言文件添加键盘快捷键描述
- 更新 package.nls.\* 文件以正确集成 VS Code
- 通过清晰的边界反馈增强用户体验

## [2.4.0] - 2025-01-22 - 增强视觉层级与演讲备注

### 🎨 新功能

- **分级标题大小差异化**：为 Markdown 标题提供专业的视觉层级结构

  - **H1**：2.0x 基础字体大小 - 最大标题，带底部边框
  - **H2**：1.7x 基础字体大小 - 次级标题，带底部边框
  - **H3**：1.4x 基础字体大小 - 中大型标题
  - **H4**：1.2x 基础字体大小 - 标准标题
  - **H5**：1.05x 基础字体大小 - 略大于正文
  - **H6**：0.95x 基础字体大小 - 略小于正文，半透明显示
  - **响应式设计** - 移动设备（<768px）自动调整大小
  - **主题兼容性** - 与所有 7 个主题无缝配合

- **HTML 注释可见化**：显示 Markdown 注释，用于演讲备注和演示提示
  - **低调显示** - 注释以 0.4 透明度和斜体样式显示
  - **特殊标记** - 注释前缀※符号，便于识别
  - **等宽字体** - 注释文本以等宽字体显示，提高可读性
  - **安全防护** - HTML 转义防止 XSS 攻击
  - **使用场景**：
    - 幻灯片标记：`<!-- 幻灯片 1 结束 -->`
    - 演讲备注：`<!-- 注意：强调这一点 -->`
    - 时间标记：`<!-- 5分钟标记 -->`
    - 互动提示：`<!-- 停顿并询问观众问题 -->`

### 🔧 技术改进

- **解析器增强**：向 MarkdownParser 添加`parseHtmlComments()`方法
- **CSS 样式**：新增`.markdown-comment`类以保持样式一致性
- **性能优化**：高效的正则表达式解析，性能影响可忽略不计
- **聚焦模式兼容**：注释随其他内容一起模糊/聚焦
- **国际化支持**：完全支持 Unicode，包括中文、日文、韩文
- **测试覆盖**：所有 134 个测试通过，保持 100%成功率

### 📚 文档

- **功能文档**：`.github/development/HEADER_SIZES_AND_COMMENTS_FEATURE.md` 综合指南
- **使用指南**：演讲备注和演示提示的最佳实践
- **技术细节**：带代码示例的实现指南
- **未来增强**：注释相关功能的路线图

## [2.3.0] - 2025-01-21 - 选择性 Markdown 解析与行间距调整

### 📝 新功能

- **选择性 Markdown 解析**：为专业演示提供革命性的 markdown 处理

  - **智能解析** - 将 markdown 内容转换为格式优美、提词器优化的文本
  - **D 键切换** - 在 webview 中即时切换原始文本和解析后的 markdown
  - **VS Code 命令** - `Ctrl+Shift+D`（macOS 上为`Cmd+Shift+D`）随时切换
  - **视觉状态指示器** - 智能定位，避免 UI 冲突
  - **持久化设置** - Markdown 模式偏好跨会话保存

- **行间距调整**：专业行距控制，实现最佳可读性
  - **快速调整** - 循环切换 5 个预设行高：1.0、1.2、1.5、1.8、2.0
  - **L 键切换** - 在 webview 模式下即时调整行间距
  - **VS Code 命令** - `Ctrl+Shift+L`（macOS 上为`Cmd+Shift+L`）系统级访问
  - **视觉反馈** - 状态栏通知显示当前行间距值
  - **实时应用** - 无需重新加载即可立即更新视觉效果

### 📊 支持的 Markdown 元素

- **文本格式**：标题（H1-H6）、粗体/斜体、代码段、链接
- **结构化内容**：表格、项目符号/数字列表、任务列表、引用块
- **代码内容**：带语言检测的语法高亮代码块
- **提词器优化**：智能间距、主题集成、聚焦模式兼容性

### ⚙️ 配置

- **新设置**：`cuemode.markdownParsing`（布尔值，默认：false）
- **命令**：`cuemode.toggleMarkdownParsing` 用于 VS Code 命令面板
- **命令**：`cuemode.adjustLineHeight` 用于行间距循环调整
- **键盘快捷键**：
  - `D`键在 webview 中即时切换 markdown
  - `Ctrl+Shift+D`（macOS 上为`Cmd+Shift+D`）从 VS Code 切换
  - `L`键在 webview 中调整行间距
  - `Ctrl+Shift+L`（macOS 上为`Cmd+Shift+L`）从 VS Code 调整行间距
- **性能**：平滑用户体验的解析时间< 50ms

## [2.2.0] - 2025-07-15 - 镜像反转功能

### 🪞 新功能

- **镜像反转模式**：为专业提词器设备添加水平文本镜像功能
  - 在 webview 中使用 `M` 键切换镜像反转
  - VS Code 命令：`Ctrl+Shift+M`（macOS 上为 `Cmd+Shift+M`）
  - 跨会话持久化设置
  - 带有平滑过渡的视觉状态指示器
  - 专业提词器硬件兼容性

### ⚙️ 配置

- **新设置**：`cuemode.mirrorFlip`（布尔值，默认：false）
- **命令**：`cuemode.toggleMirrorFlip` 用于 VS Code 命令面板
- **键盘快捷键**：`Ctrl+Shift+M`（macOS 上为 `Cmd+Shift+M`）

### 🔧 技术改进

- **增强测试**：添加全面的镜像反转测试套件（总计 82 个测试）
- **UI 增强**：添加带有视觉反馈的镜像反转状态指示器
- **国际化支持**：为所有支持的语言添加镜像反转翻译
- **配置验证**：增强对镜像反转设置的配置验证

### 📚 文档

- **README**：更新镜像反转功能文档
- **帮助文本**：更新应用内帮助，添加 M 键快捷键
- **开发计划**：记录全面的 6 阶段开发计划

## [2.1.1] - 2025-07-14 - 构建流程与包优化

### 🔧 构建流程改进

- **增强构建管道**：改进 vscode:prepublish 脚本，集成 esbuild 以获得更好的性能
- **包优化**：添加 esbuild 打包，减少包大小并提高性能
- **本地化包文件**：为市场展示添加 VS Code 包本地化文件
  - 添加 `package.nls.de.json` 用于德语市场列表
  - 添加 `package.nls.fr.json` 用于法语市场列表
  - 添加 `package.nls.ja.json` 用于日语市场列表
  - 添加 `package.nls.ko.json` 用于韩语市场列表
- **改进 .vscodeignore**：更好地排除开发文件，减小包大小
- **发布流程增强**：更新发布检查清单，增加 git pull 要求

### 🐛 错误修复

- **命令注册**：修复 'cuemode.cueMode' 命令未找到问题
- **构建脚本**：解决 esbuild 在预发布工作流中的集成问题
- **包大小**：优化最终包大小至 64KB（目标：<1MB）

### 📦 包信息

- **包大小**：64KB（已优化）
- **打包大小**：158.4KB（esbuild 优化）
- **包含文件**：20 个文件，支持全面的本地化
- **支持语言**：运行时和市场列表均支持 6 种语言

## [2.1.0] - 2025-07-14 - 聚焦模式与国际化系统重构

### 🌟 新增功能

- **聚焦模式**：新增聚焦阅读模式，通过模糊非焦点内容突出显示当前阅读区域
  - 可配置聚焦不透明度（0.1-0.8，默认 0.3）
  - 可调节聚焦行数（1-10 行，默认 3 行）
  - 提词器模式下按 `F` 键即时切换聚焦模式
  - 增加了 `toggleFocusMode` 命令
- **智能渐变模糊算法**：提供平滑的阅读体验，包含缓冲区域
- **聚焦指示器**：可视化显示当前活跃阅读区域

### 🌐 国际化系统重构

- **i18next 集成**：使用行业标准的 i18next 库替换自定义国际化系统
- **动态语言切换**：支持运行时语言切换，无需重启扩展
- **增强的翻译功能**：
  - 支持 `{{变量}}` 语法的插值
  - 复数形式支持
  - 上下文感知翻译
  - 缺失键处理和回退机制
- **自动语言检测**：从 VS Code 环境或系统区域设置自动检测语言
- **类型安全**：改进翻译键和参数的类型安全性

### 🔧 架构改进

- **文件结构重组**：
  - 移除 `src/i18n/` TypeScript 文件目录
  - 新增 `src/locales/` JSON 翻译文件目录
  - 新增集中式 `src/i18n.ts` 国际化管理器
- **配置架构更新**：扩展配置接口，新增聚焦模式相关属性
- **依赖管理**：添加 i18next 作为生产依赖

### 🚀 用户体验增强

- **实时配置更新**：聚焦模式设置实时生效，无需重启
- **增强的键盘快捷键**：
  - `F` 键：切换聚焦模式
  - `T` 键：循环主题切换
  - 改进的帮助系统，包含本地化快捷键说明
- **视觉反馈优化**：
  - 聚焦区域指示器，采用精美样式设计
  - 改进行换行以提高聚焦模式兼容性
  - 为不同模式和状态提供清晰的视觉反馈

### 🧪 质量保证

- **增强的测试套件**：
  - 新的 i18next 系统全面测试覆盖
  - 聚焦模式配置和行为测试
  - 更新的配置属性测试
  - 英文和中文翻译测试
- **类型安全改进**：增强 i18n 函数的类型定义，防止运行时错误

### 🛠️ 技术改进

- **构建系统优化**：自动复制 JSON 翻译文件
- **性能优化**：
  - 高效的翻译加载和缓存
  - 使用 requestAnimationFrame 优化聚焦模式模糊计算
  - 改进内存管理和资源清理
- **异步扩展激活**：正确初始化 i18n 的异步激活流程

### 🎯 可访问性改进

- **屏幕阅读器支持**：增强 ARIA 标签和语义标记
- **键盘导航**：改进仅键盘导航体验
- **视觉反馈**：为不同模式和状态提供清晰的视觉指示器

## [2.0.0] - 2025-07-12 - 专业提词器 2.0

### 🚀 主要功能

- **T 键主题切换**：在提词器模式下按'T'键可立即切换主题
- **专业命令套件**：添加了 `changeTheme` 和 `removeLeadingSpaces` 命令
- **高级键盘快捷键**：
  - `Ctrl+Shift+T`（Mac 上为 Cmd+Shift+T）- 通过菜单更改主题
  - `Ctrl+Shift+R`（Mac 上为 Cmd+Shift+R）- 移除前导空格
  - 提词器模式下的 `T` 键 - 即时主题切换
- **内容预处理**：用于清理演示文稿缩进文本的新命令
- **交互式帮助系统**：增强的帮助面板，支持点击外部关闭功能

### 🎯 专业提词器焦点

- **TypeScript 迁移**：完整代码库重写，提高可维护性
- **全面测试**：71 个测试用例确保可靠性
- **自动滚动控制**：专业空格键控制
- **实时速度调整**：+/-键进行实时节奏控制
- **方向切换**：R 键用于反向滚动
- **极简 UI**：无干扰的阅读体验
- **专业主题**：针对视频录制和演示进行优化

### 🌐 增强的用户体验

- **非侵入式通知**：自动消失的状态栏消息（2-3 秒）
- **无缝 UX**：移除模态对话框，提供快速状态反馈
- **国际化**：完整的英文和中文支持
- **增强的错误处理**：专业级日志记录和恢复

### 🛠️ 技术改进

- 从 `showInformationMessage` 迁移到 `setStatusBarMessage` 以获得更好的用户体验
- 向 WebView 通信添加了 `cycleTheme` 消息类型
- 增强的命令注册和清理
- 改进事件监听器的内存管理
- 严格的 TypeScript 类型和全面的错误处理

### 📈 代码质量

- 专业提词器功能重点
- 全面的测试框架（71 个测试用例）
- 增强的专业使用键盘快捷键
- 增强的错误处理和日志记录
- 专业提词器主题优化

### 新增

- 专业提词器功能重点
- TypeScript 迁移以提高代码可维护性
- 全面的测试框架（71 个测试用例）
- 带空格键的自动滚动提词器控制
- 用+/-键进行实时速度调整
- 用 R 键进行方向切换以实现反向滚动
- 增强的专业使用键盘快捷键
- 无干扰阅读的极简 UI
- 国际化支持（英文/中文）
- 增强的错误处理和日志记录
- 专业提词器主题优化

### 更改

- **重大变化**：重新定位为专业提词器工具
- 更新所有文档以专注于提词器用例
- 模块化架构以更好地组织代码
- 增强的开发工具和构建过程
- 改进营销文案，强调提词器功能
- 更新包描述和关键词以提高可发现性

### 修复

- 各种稳定性改进
- 跨平台兼容性问题
- 自动滚动性能优化

## [1.1.3] - 2025-07-12 - 专业提词器更新

### 新增

- ✨ **自动滚动提词器**：带空格键的专业滚动控制
- ✨ **实时速度控制**：在演示过程中用+/-键调整阅读节奏
- ✨ **方向切换**：用 R 键反向滚动以实现灵活阅读
- ✨ **增强的键盘快捷键**：完整的专业提词器控制集
- ✨ **极简 UI**：隐藏控件以实现无干扰阅读体验
- 🌐 **多语言支持**：英文和中文界面
- 📺 **提词器优化**：改进的主题和布局，用于视频录制

### 更改

- **重新品牌为专业提词器**：所有文档已更新
- **增强的用户体验**：即时反馈和流畅控制
- **专业重点**：针对内容创作者和教育者进行优化

### 修复

- 错误修复和稳定性改进
- 流畅自动滚动的性能优化
- 跨不同主题的 UI 一致性

## [1.1.0] - 2024-XX-XX - 增强的演示功能

### 新增

- 实时设置更新 - 更改现在立即反映在提词器模式中
- 实时内容同步 - 文本修改无需重新进入模式即可更新
- 改进的起始位置 - 内容现在居中以获得更好的提词器体验

### 更改

- 通过即时反馈增强用户体验
- 更好的内容显示定位算法
- 改进的演示流程和可用性

### 修复

- 解决了设置未立即应用的问题
- 修复了内容定位不一致问题
- 提高了整体稳定性

## [1.0.0] - 2024-XX-XX

### 新增

- CueMode 扩展的初始版本
- 基本的"提示模式"功能，用于增强可读性
- 多种颜色主题（经典、反转、午夜蓝、日落、森林、海洋、玫瑰）
- 字体大小、行高和布局的可自定义设置
- 上下文菜单集成，便于访问
- 可配置的滚动速度和起始位置
- 基于 WebView 的演示界面

### 功能

- 字体大小调整（默认：24pt）
- 行高控制（默认：1.5em）
- 内容宽度限制（默认：800px）
- 填充自定义（默认：10px）
- 滚动速度控制（默认：0.1）
- 起始位置配置（默认：50%）
- 七种美丽的颜色主题可供选择

---

## 版本历史摘要

| 版本  | 发布日期   | 主要功能                                                                      |
| ----- | ---------- | ----------------------------------------------------------------------------- |
| 2.2.0 | 2025-07-15 | **镜像翻转与专业提词器支持** - M 键切换、水平镜像、状态指示器、UI 优化        |
| 2.1.0 | 2025-07-14 | **聚焦模式与国际化系统重构** - F 键切换、6 种语言支持、i18next 集成、增强测试 |
| 2.0.0 | 2025-07-12 | **专业提词器 2.0** - T 键切换、TypeScript 迁移、71 个测试                     |
| 1.1.3 | 2025-07-12 | 错误修复、性能改进                                                            |
| 1.1.0 | 2024       | 实时更新、实时同步、改进定位                                                  |
| 1.0.0 | 2024       | 初始版本、基本功能                                                            |

---

## 升级指南

### 从 1.1.0 到 1.1.3

- 无重大变化
- 通过 VS Code 自动更新
- 保留所有现有设置

### 从 1.0.0 到 1.1.0

- 无重大变化
- 新的实时更新功能自动可用
- 设置迁移自动处理

---

_有关即将推出功能的更多信息，请参阅我们的[路线图](ROADMAP.zh-CN.md)。_
